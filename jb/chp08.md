# Chp.08 : 경계

외부 코드를 우리 코드에 깔끔하게 통합하기 위해 소프트웨어 경계를 잘 처리하는 방법에 대해 알아보자.<br>

## **[ 외부 코드 사용하기 ]**

- 인터페이스 제공자와 사용자 간의 바라는 점이 다르다
    - 제공자 : 더 많은 환경에서 실행시킬 수 있도록 적용성을 최대치로 높이기
    - 사용자 : 본인의 요구에 최적화된 인터페이스 요청
- 인터페이스가 제공하는 기능을 외부에 공개하지 X (아무에게나 기능 수정, 삭제, 추가할 수 있는 권한을 부여하면 위험하다)
    - [아래 코드 참고]
        1. 경계 인터페이스 Map을 Sensors 안에 숨김 → Map이 변하더라도 나머지 프로그램에 영향X
        2. Sensors 클래스는 프로그램에 필요한 인터페이스만 제공 → 가독성 O, 오용 X
        3. 캡슐화 목적 : Map 외에도 다른 경계 인터페이스들을 아무데나 노출시키지 않으려고.

```java
// 변경 전 : 클라이언트가 Map이 반환하는 객체를 알맞는 type(Sensor)으로 변환함
Map sensors = new HashMap();
Sensor s = (Sensor)sensors.get(sensorId);

// 변경 시도1 (실패) : Generics 사용으로 인해 가독성이 높아졌지만 
//                  여전히 외부 사용자가 기능들을 수정할 수 있음
Map<String, Sensor> sensors = new HashMap<Sensor>();
...
Sensor s = sensors.get(sensorId);

// 변경 시도2 (성공) : Generics 사용 여부를 Sensors class안에서 결정하므로
//                  사용자는 Generics 사용 여부를 알 필요 없음!
public class Sensors {
	private Map sensors = new HashMap();

	public Sensor getById(String id) {
		return (Sensor)sensors.get(id);
	}
}
```

## **[ 경계 살피고 익히기 ]**

- 외부 코드를 사용하면 적은 시간에 더 많은 기능을 출시할 수 있지만, 외부 코드 사용법을 제대로 익히지 못한 상태에서 내 코드에 적용하려하면 에러 나기 쉽다.
- 학습 테스트 : 내 코드를 작성한 다음, 외부 코드 호출하기 전에 먼저 간단한 테스트 케이스를 작성해서 외부 코드를 익히는 방법. 즉, 프로그램 목적에 맞게 외부 API를 사용/호출한다.<br>

## **[ Log4j 익히기 ]**

- 테스트 케이스에 아파치의 log4j 패키지 사용 → 다양한 오류 발생
- p.148-149 : 여러 단위 테스트 케이스로 나눠서 오류를 잡고, 독자적인 logger class로 캡슐화하면 나머지 프로그램은 log4j 라는 경계 인터페이스를 몰라도 잘 실행됨.<br>

## **[ 학습 테스트 활용 ]**

- 학습 테스트는 패키지가 예상대로 도는지 검증한다.
- 패키지 작성자가 버그 수정, 새 기능 추가해서 새로운 버전을 만듦 → 새로운 버전이 내 코드랑 호환이 잘 안될 수 있으므로 학습 테스트로 다시 검증해주어야 함
- 실제 코드와 동일한 방식으로 인터페이스를 사용하는 테스트 케이스를 만들기 → 패키지의 새 버전으로 이전하기 쉬워짐

## **[ 아직 존재하지 않는 코드를 사용하기 ]**

- 아는 코드와 모르는 코드를 분리하는 경계 <br>

## **[ 깨끗한 경계 ]**

- S/W 설계에 시간, 비용을 많이 투자한 경우 → 변경/유지보수가 쉬워짐
- S/W 설계, 코드가 엉망인 경우 → 앞으로 투자해야할 변경 비용이 커짐
- 경계에 위치하는 코드는 깔끔히 분리한다.
- 기대치를 정의하는 테스트 케이스 필요.
- 외부 패키지 의존성을 높이지 말고, 통제 가능한 내 코드에 의존해야함

  → 외부 패키지 호출하는 코드를 가능한 줄여서 경계를 관리하자

    1. 새로운 클래스로 경계 감싸기
    2. ADAPTER 패턴을 사용하여 내가 원하는 인터페이스를 패키지가 제공하는 인터페이스로 변환

  → 코드 가독성 높아짐, 일관성 높아짐, 유지보수 쉬워짐